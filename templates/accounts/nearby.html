{% extends "base.html" %}

{% block title %}Nearby Classmates - StudyIt{% endblock %}

{% block content %}
<div style="max-width: 960px; margin: 2rem auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h1 style="color: #003057;">Nearby Classmates</h1>
        <a href="{% url 'accounts:profile_edit' %}" style="background: #003057; color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 5px; font-weight: 500;">Edit Profile</a>
    </div>
    
    {% if current_location %}
        <div style="margin-bottom: 1rem; color: #555;">
            <strong style="color: #003057;">Your Location:</strong>
            <span>{{ current_location.name }}</span>
        </div>
    {% else %}
        <div style="padding: 1rem; border: 2px solid #ffc107; background: #fff3cd; color: #664d03; border-radius: 8px;">
            Set your current location in your profile to find nearby classmates.
            <a href="{% url 'accounts:profile_edit' %}" style="color: #003057; font-weight: 600; margin-left: 0.25rem;">Update now â†’</a>
        </div>
    {% endif %}
    
    {% if current_location %}
    <div style="display: grid; grid-template-columns: 1fr; gap: 1.5rem;">
        <section style="background: white; padding: 1.25rem; border-radius: 10px; border: 1px solid #e5e7eb;">
            <h2 style="color: #003057; font-size: 1.25rem; margin-bottom: 0.75rem;">Counts by Class</h2>
            {% if user_classes_data %}
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 0.75rem;">
                    {% for item in user_classes_data %}
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 0.9rem; background: #f8fafc;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 700; color: #003057;">{{ item.code }}</div>
                                    <div style="font-size: 0.85rem; color: #6b7280;">{{ item.name }}</div>
                                </div>
                                <div style="font-weight: 700; color: #003057; font-size: 1.1rem;">{{ item.count }}</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="color: #6b7280;">You have no classes added. Add classes to see nearby classmates.</div>
            {% endif %}
        </section>
        
        <section style="background: white; padding: 1.25rem; border-radius: 10px; border: 1px solid #e5e7eb;">
            <h2 style="color: #003057; font-size: 1.25rem; margin-bottom: 0.75rem;">Classmates by Class</h2>
            {% if user_classes_data %}
                {% for item in user_classes_data %}
                    <div style="border-top: 1px solid #e5e7eb; padding-top: 1rem; margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div style="font-weight: 700; color: #003057;">{{ item.code }}</div>
                            <div style="color: #6b7280; font-size: 0.9rem;">{{ item.count }} nearby</div>
                        </div>
                        {% if item.members %}
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 0.75rem;">
                                {% for p in item.members %}
                                    <a href="{% url 'accounts:profile_detail' p.user.id %}" style="display: block; text-decoration: none; color: inherit;">
                                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 0.9rem;">
                                            <div style="font-weight: 600; color: #111827;">{{ p.name }}</div>
                                            <div style="color: #6b7280; font-size: 0.9rem;">{{ p.get_year_display }}</div>
                                        </div>
                                    </a>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div style="color: #6b7280; font-size: 0.95rem;">No visible classmates nearby for this class.</div>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <div style="color: #6b7280;">No classes to display.</div>
            {% endif %}
        </section>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}{% endblock %}


